
scheme = {
	"": [
		{
			"ca_": "karavan",
			"ka_": "kami",
			"fy_": "fyros",
			"tr_": "tryker",
			"zo_": "zorai",
			"ma_": "matis",
			"ge_": "common",
			"ge_zo_": "common zorai",
			"ge_ma_": "common matis",
			"ge_tr_": "common tryker",
			"ge_fy_": "common fyros",
		},
		{
			"acc_": "accessory",
			"wea_": "weapon",
			"wea_trib_": "weapon regular tribe",
			"wea_high_": "weapon high tribe",
			"hom_": "male",
			"hof_": "female",
		},
		{
			"acc": "accessory",
			"armor00": "medium armor armor00",
			"armor01": "heavy armor armor01",
			"armor04": "second heavy armor armor04",
			"casque01": "heavy armor helmet casque01",
			"caster01": "light caster armor caster01",
			"civil01": "light armor civil01",
			"light02": "second light armor",
			"medium02": "second medium armor",
			"heavy02": "second heavy armor",
			"light03": "third light armor",
			"medium03": "third medium armor",
			"heavy03": "third heavy armor",
			"light04": "fourth light armor",
			"medium04": "fourth medium armor",
			"heavy04": "fourth heavy armor",
			"cheveux": "hairstyle",
			"underwear": "underwear armor",
			"underwear_hand": "underwear armor gloves hands",
			"refugee": "refugee armor",
			"refugee02": "second refugee armor",
			"refugee03": "third refugee armor",
			"refugee04": "fourth refugee armor",
		},
		{
			"_gauntlet": "magic amplifier gloves",
			"_armpad": "sleeves",
			"_bottes": "boots",
			"_botte": "boots",
			"_gilet": "vest",
			"_torse": "vest",
			"_hand": "gloves",
			"_pantabottes": "pants",
			"_pantabotte": "pants",
			"_casque": "helmet",
			"_lead": "lead event",
			"_fp": "first-person",
			"_b": "b",
			"_c": "c",
			"_d": "d",
			"_e": "e",
			"_f": "f",
			"_g": "g",
			"_h": "h",
		},
		{
			"_armpad": "sleeves",
			"_bottes": "boots",
			"_botte": "boots",
			"_gilet": "vest",
			"_hand": "gloves",
			"_pantabottes": "pants",
			"_pantabotte": "pants",
			"_casque": "helmet",
			"_fp": "first-person",
			"_gen": "generic",
			"_kami": "kami",
			"_b": "b",
			"_c": "c",
			"_d": "d",
			"_e": "e",
			"_f": "f",
			"_g": "g",
			"_h": "h",
			"_02": "02",
		},
		{
			"_fp": "first-person",
		},
		{},
		{},
	],
	"caster": [
		{},
		{},
		{},
		{
			"_armor00": "medium alternative",
			"_armor01": "heavy alternative",
			"_civil01": "light alternative",
			"_civil": "light alternative",
			"_underwear": "underwear alternative",
		},
		{
			"_armor00": "medium alternative",
			"_armor01": "heavy alternative",
			"_civil01": "light alternative",
			"_civil": "light alternative",
			"_underwear": "underwear alternative",
		},
		{},
		{},
		{},
		{},
	],
	"karavan": [
		{},
		{},
		{
			"armor01": "armor", # todo
			"armor02": "second armor", # todo
			"casque01": "armor", # todo
			"casque02": "second armor", # todo
			"casque03": "third armor", # todo
			"casque04": "fourth armor", # todo
			"commander": "commander",
			"medic": "medic",
			"ingeneer": "engineer",
			"trooper": "trooper",
		},
		{
			"_hum": "human crafted",
			"_gun": "laser gun",
		},
		{},
		{},
	],
	"kami": [
		{},
		{},
		{},
		{},
		{},
	],
	"common": [
		{},
		{},
		{
			"caster00": "boss light caster armor",
			"armor02": "boss light armor",
			"armor03": "boss medium armor",
			"armor04": "boss heavy armor",
			"armor06": "second heavy armor",
			"casque00": "boss heavy armor helmet",
			"casque02": "second heavy armor helmet",
		},
		{},
		{},
		{},
	],
	"hairstyle": [
		{},
		{},
		{},
		{
			"_artistic": "artistic",
			"_basic": "basic",
			"_long": "long",
			"_medium": "medium",
			"_shave": "shave",
			"_short": "short",
			"_style": "style",
			"_lead": "lead event",
		},
		{
			"01": "01",
			"02": "02",
			"03": "03",
			"04": "04",
			"05": "05",
			"06": "06",
			"07": "07",
			"08": "08",
		},
		{},
		{},
		{},
	],
	"accessory": [
		{},
		{},
		{
			"banner": "event banner",
			"baniere": "event banner",
		},
		{},
		{},
		{},
		{},
		{},
	],
	"weapon": [
		{},
		{},
		{
			"masse1m": "melee one-handed blunt mace",
			"masse2m": "melee two-handed blunt mace",
			"baton": "melee one-handed blunt staff",
			"baton1m": "melee one-handed blunt staff",
			"batonspellcaster": "magic amplifier staff",
			"dague": "melee one-handed piercing dagger",
			"lance1m": "melee one-handed piercing spear",
			"lance2m": "melee two-handed piercing pike",
			"hache1m": "melee one-handed slashing axe",
			"hache2m": "melee two-handed slashing axe",
			"epee1m": "melee one-handed slashing sword",
			"epee2m": "melee two-handed slashing sword",
			"ms": "magic amplifier gloves",
			"pistolarc": "ranged one-handed bowpistol",
			"pistolet": "ranged one-handed pistol",
			"gatling": "ranged two-handed autolauncher",
			"gattling": "ranged two-handed autolauncher",
			"fusarc": "ranged two-handed bowrifle",
			# "2h": "ranged two-handed harpoon",
			"lanceroquette": "ranged two-handed launcher",
			"launcher": "ranged two-handed launcher",
			"fusil": "ranged two-handed rifle",
			"petit_bouclier": "buckler shield",
			"grand_bouclier": "large shield",
			"grandbouclier": "large shield",
			"grenade": "grenade", # todo
		},
		{
			"_sousmarin": "underwater",
			"_trail": "trail",
		},
		{
			"_00": "default",
			"_gen": "generic",
			"_car": "karavan",
			"_kam": "kami",
		},
		{},
		{},
		{},
		{},
	],
}

def addTags(sub, depth, tags):
	for i in range(len(tags) - 1, -1, -1):
		tag = tags[i]
		if tag in scheme:
			s = scheme[tag]
			largest = 0
			for k in s[depth]:
				if len(k) >= largest and sub.startswith(k):
					largest = len(k)
			if largest > 0:
				for k in s[depth]:
					if len(k) >= largest and sub.startswith(k):
						tags += s[depth][k].split(" ")
						return k
	return ""

def parse(name):
	tags = [ "" ]
	sub = name
	depth = 0
	while len(sub) > 0:
		add = addTags(sub, depth, tags)
		if len(add) == 0:
			return tags[1:] + [ "incomplete", "_" + sub ]
		sub = sub[len(add):]
		depth += 1
	return tags[1:]

with open("shape_list.txt", "r") as f:
	with open("shape_parsed.tsv", "w") as fw:
		for l in f:
			if "_mission_" not in l:
				name = l.strip().split(".")[0]
				tags = parse(name)
				if name.startswith("tr_hof_underwear_") and not name.endswith("_gilet") and not name.endswith("_pantabottes"):
					tags.remove("tryker")
				if name.startswith("zo_hof_underwear_") and not name.endswith("_gilet") and not name.endswith("_pantabottes"):
					tags.remove("zorai")
				if name.startswith("tr_hom_underwear_") and not name.endswith("_pantabottes"):
					tags.remove("tryker")
				if name.startswith("zo_hom_underwear_") and not name.endswith("_pantabottes"):
					tags.remove("zorai")
				# gen = generate(tags)
				# if gen != name:
				#{ 	tags += [ "invalid" ]
				fw.write(name + "\t")
				for t in tags:
					fw.write("\t" + t)
				fw.write("\n")
				if "incomplete" in tags:
					print(name)
					print(tags)
		fw.flush()

with open("sfx_shape_list.txt", "r") as f:
	with open("sfx_shape_parsed.tsv", "w") as fw:
		for l in f:
			name = l.strip().split(".")[0]
			tags = parse(name)
			fw.write(name + "\t")
			for t in tags:
				fw.write("\t" + t)
			fw.write("\n")
			if "incomplete" in tags:
				print(name)
				print(tags)
		fw.flush()
		fw.flush()

with open("sfx_ps_list.txt", "r") as f:
	with open("sfx_ps_parsed.tsv", "w") as fw:
		for l in f:
			name = l.strip().split(".")[0]
			tags = parse(name)
			fw.write(name + "\t")
			for t in tags:
				fw.write("\t" + t)
			fw.write("\n")
			if "incomplete" in tags:
				print(name)
				print(tags)
		fw.flush()
